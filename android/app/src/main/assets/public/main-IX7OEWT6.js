import{B as A,C as m,D as _,Da as J,E,Ga as G,Ib as X,Kb as Z,M as $,N as D,Q as F,R as z,U as j,W as R,X as U,Y as B,Za as H,a as v,aa as L,b as y,ba as V,c as k,da as q,f as O,g as P,hb as K,k as d,l as g,m as h,n as x,o as T,p,q as s,r,rb as Q,s as u,v as N,w as M,x as l,xb as W,ya as Y}from"./chunk-MLULCTM5.js";import"./chunk-LC24JGNW.js";import"./chunk-ZZ4VNCGA.js";import"./chunk-Q2GNM4N3.js";import"./chunk-42BYYQSV.js";import"./chunk-PGY34PD4.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-XO2KZLEH.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as S,b as I,g as f}from"./chunk-2R6CW7ES.js";var tt=[{path:"",loadChildren:()=>import("./chunk-JCFGPWLJ.js").then(n=>n.routes)},{path:"shared/:shareId",loadComponent:()=>import("./chunk-KTXWGQB2.js").then(n=>n.SharedRoadmapPage)}];var w=(()=>{let o=class o{constructor(){this.API_URL="http://localhost:3000/api/notifications",this.activeNotifications=new v([]),this.notifications$=this.activeNotifications.asObservable(),this.nextNotificationCountdown=new v(null),this.countdown$=this.nextNotificationCountdown.asObservable(),this.pollingSubscription=null,this.countdownSubscription=null,this.lastSeenNotificationIds=new Set,this.startPolling()}startPolling(){this.pollingSubscription||(this.pollingSubscription=y(5e3).subscribe(()=>{this.checkForNewNotifications()}),this.countdownSubscription=y(1e3).subscribe(()=>{this.updateCountdown()}),this.checkForNewNotifications(),this.updateCountdown())}stopPolling(){this.pollingSubscription&&(this.pollingSubscription.unsubscribe(),this.pollingSubscription=null),this.countdownSubscription&&(this.countdownSubscription.unsubscribe(),this.countdownSubscription=null)}checkForNewNotifications(){return f(this,null,function*(){try{let t=yield fetch(`${this.API_URL}?status=sent`);if(!t.ok)return;let a=(yield t.json()).notifications||[],b=new Date(Date.now()-3e4);for(let c of a){let C=new Date(c.sentAt||c.createdAt);C>b&&!this.lastSeenNotificationIds.has(c._id)&&(this.lastSeenNotificationIds.add(c._id),this.showNotification({id:c._id,title:c.title,message:c.message,type:c.type,timestamp:C,metadata:c.metadata}))}if(this.lastSeenNotificationIds.size>100){let c=Array.from(this.lastSeenNotificationIds);this.lastSeenNotificationIds=new Set(c.slice(-50))}}catch(t){console.error("Error checking for notifications:",t)}})}updateCountdown(){return f(this,null,function*(){try{let t=yield fetch(`${this.API_URL}/next`);if(!t.ok){this.nextNotificationCountdown.next(null);return}let i=yield t.json();i.notification?this.nextNotificationCountdown.next({notification:i.notification,timeUntil:i.timeUntil,formatted:i.timeUntilFormatted}):this.nextNotificationCountdown.next(null)}catch{}})}showNotification(t){let i=this.activeNotifications.value;this.activeNotifications.next([t,...i]),setTimeout(()=>{this.dismissNotification(t.id)},1e4),this.showBrowserNotification(t)}dismissNotification(t){let i=this.activeNotifications.value;this.activeNotifications.next(i.filter(a=>a.id!==t))}clearAll(){this.activeNotifications.next([])}showBrowserNotification(t){return f(this,null,function*(){"Notification"in window&&(Notification.permission==="granted"?new Notification(t.title,{body:t.message,icon:"/assets/icon/favicon.png",tag:t.id}):Notification.permission!=="denied"&&(yield Notification.requestPermission())==="granted"&&new Notification(t.title,{body:t.message,icon:"/assets/icon/favicon.png",tag:t.id}))})}requestPermission(){return f(this,null,function*(){return"Notification"in window?Notification.permission==="granted"?!0:(yield Notification.requestPermission())==="granted":!1})}getScheduledNotifications(){return f(this,null,function*(){try{let t=yield fetch(`${this.API_URL}?status=pending`);return t.ok?(yield t.json()).notifications||[]:[]}catch(t){return console.error("Error fetching scheduled notifications:",t),[]}})}scheduleNotification(t,i,a,b=2){return f(this,null,function*(){try{let c=yield fetch(`${this.API_URL}/schedule`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:t,title:i,message:a,delayMinutes:b})});return c.ok?(yield c.json()).notification:null}catch(c){return console.error("Error scheduling notification:",c),null}})}cancelNotification(t){return f(this,null,function*(){try{return(yield fetch(`${this.API_URL}/${t}`,{method:"DELETE"})).ok}catch(i){return console.error("Error cancelling notification:",i),!1}})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"});let n=o;return n})();function at(n,o){if(n&1&&(s(0,"div",13),m(1),r()),n&2){let e=l().$implicit;d(),E(" \u{1F4DA} ",e.metadata.roadmapTitle," ")}}function ct(n,o){if(n&1){let e=N();s(0,"div",4)(1,"div",5),u(2,"ion-icon",6),r(),s(3,"div",7)(4,"div",8),m(5),r(),s(6,"div",9),m(7),r(),x(8,at,2,1,"div",10),r(),s(9,"button",11),M("click",function(){let i=O(e).$implicit,a=l(2);return P(a.dismiss(i.id))}),u(10,"ion-icon",12),r()()}if(n&2){let e=o.$implicit,t=l(2);A("entering",e.entering)("exiting",e.exiting),d(),T("data-type",e.type),d(),p("name",t.getIcon(e.type)),d(3),_(e.title),d(2),_(e.message),d(),p("ngIf",e.metadata==null?null:e.metadata.roadmapTitle)}}function st(n,o){if(n&1&&(s(0,"div",2),x(1,ct,11,9,"div",3),r()),n&2){let e=l();d(),p("ngForOf",e.notifications)("ngForTrackBy",e.trackById)}}function rt(n,o){if(n&1){let e=N();s(0,"div",14),M("click",function(){O(e);let i=l();return P(i.showCountdownDetails())}),u(1,"ion-icon",15),s(2,"span"),m(3),r()()}if(n&2){let e=l();d(3),_(e.countdown.formatted)}}var ot=(()=>{let o=class o{constructor(t){this.notificationService=t,this.notifications=[],this.countdown=null,this.notificationSub=null,this.countdownSub=null,G({closeOutline:H,rocketOutline:W,flameOutline:K,trophyOutline:Z,notificationsOutline:Q,timeOutline:X})}ngOnInit(){this.notificationSub=this.notificationService.notifications$.subscribe(t=>{this.notifications=t.map(i=>I(S({},i),{entering:!this.notifications.find(a=>a.id===i.id)}))}),this.countdownSub=this.notificationService.countdown$.subscribe(t=>{this.countdown=t})}ngOnDestroy(){this.notificationSub?.unsubscribe(),this.countdownSub?.unsubscribe()}getIcon(t){return{skill_added:"rocket-outline",streak_reminder:"flame-outline",achievement:"trophy-outline",daily_reminder:"notifications-outline",custom:"notifications-outline"}[t]||"notifications-outline"}dismiss(t){let i=this.notifications.find(a=>a.id===t);i&&(i.exiting=!0,setTimeout(()=>{this.notificationService.dismissNotification(t)},300))}trackById(t,i){return i.id}showCountdownDetails(){this.countdown?.notification&&alert(`Next notification in ${this.countdown.formatted}:

${this.countdown.notification.title}
${this.countdown.notification.message}`)}};o.\u0275fac=function(i){return new(i||o)(g(w))},o.\u0275cmp=h({type:o,selectors:[["app-notification-toast"]],decls:2,vars:2,consts:[["class","notification-container",4,"ngIf"],["class","countdown-badge",3,"click",4,"ngIf"],[1,"notification-container"],["class","notification-toast",3,"entering","exiting",4,"ngFor","ngForOf","ngForTrackBy"],[1,"notification-toast"],[1,"notification-icon"],[3,"name"],[1,"notification-content"],[1,"notification-title"],[1,"notification-message"],["class","notification-meta",4,"ngIf"],[1,"notification-close",3,"click"],["name","close-outline"],[1,"notification-meta"],[1,"countdown-badge",3,"click"],["name","time-outline"]],template:function(i,a){i&1&&x(0,st,2,2,"div",0)(1,rt,4,1,"div",1),i&2&&(p("ngIf",a.notifications.length>0),d(),p("ngIf",a.countdown&&a.countdown.timeUntil>0))},dependencies:[F,$,D,J],styles:[".notification-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:12px;max-width:400px;pointer-events:none}.notification-toast[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px;padding:16px;background:linear-gradient(135deg,#1e293b,#0f172a);border-radius:16px;box-shadow:0 20px 40px #0006,0 0 0 1px #ffffff1a,0 0 30px #6366f133;pointer-events:auto;animation:_ngcontent-%COMP%_slideIn .4s cubic-bezier(.34,1.56,.64,1);transform-origin:top right}.notification-toast.entering[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .4s cubic-bezier(.34,1.56,.64,1)}.notification-toast.exiting[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideOut .3s ease-in forwards}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translate(100px) scale(.8)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes _ngcontent-%COMP%_slideOut{0%{opacity:1;transform:translate(0) scale(1)}to{opacity:0;transform:translate(100px) scale(.8)}}.notification-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;animation:_ngcontent-%COMP%_pulse 2s infinite}.notification-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#fff}.notification-icon[data-type=skill_added][_ngcontent-%COMP%]{background:linear-gradient(135deg,#6366f1,#8b5cf6)}.notification-icon[data-type=streak_reminder][_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#ef4444)}.notification-icon[data-type=achievement][_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#14b8a6)}.notification-icon[data-type=daily_reminder][_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#6366f1)}.notification-icon[data-type=custom][_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#ec4899)}@keyframes _ngcontent-%COMP%_pulse{0%,to{box-shadow:0 0 #6366f166}50%{box-shadow:0 0 0 8px #6366f100}}.notification-content[_ngcontent-%COMP%]{flex:1;min-width:0}.notification-title[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#f1f5f9;margin-bottom:4px;line-height:1.3}.notification-message[_ngcontent-%COMP%]{font-size:14px;color:#94a3b8;line-height:1.5;margin-bottom:8px}.notification-meta[_ngcontent-%COMP%]{font-size:12px;color:#6366f1;font-weight:500}.notification-close[_ngcontent-%COMP%]{background:#ffffff1a;border:none;border-radius:8px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0}.notification-close[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;color:#94a3b8}.notification-close[_ngcontent-%COMP%]:hover{background:#fff3}.notification-close[_ngcontent-%COMP%]:hover   ion-icon[_ngcontent-%COMP%]{color:#f1f5f9}.countdown-badge[_ngcontent-%COMP%]{position:fixed;bottom:100px;right:20px;z-index:9999;display:flex;align-items:center;gap:8px;padding:12px 16px;background:linear-gradient(135deg,#6366f1,#8b5cf6);border-radius:30px;box-shadow:0 4px 20px #6366f166;cursor:pointer;animation:_ngcontent-%COMP%_bounce 2s infinite;transition:transform .2s ease}.countdown-badge[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.countdown-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#fff}.countdown-badge[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;font-weight:700;color:#fff;font-family:SF Mono,Fira Code,monospace}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:translateY(0)}50%{transform:translateY(-5px)}}@media (max-width: 480px){.notification-container[_ngcontent-%COMP%]{top:10px;right:10px;left:10px;max-width:none}.notification-toast[_ngcontent-%COMP%]{padding:12px}.notification-icon[_ngcontent-%COMP%]{width:40px;height:40px}.notification-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.countdown-badge[_ngcontent-%COMP%]{bottom:80px;right:10px}}"]});let n=o;return n})();var et=(()=>{let o=class o{constructor(t){this.notificationService=t}ngOnInit(){return f(this,null,function*(){yield this.notificationService.requestPermission()})}};o.\u0275fac=function(i){return new(i||o)(g(w))},o.\u0275cmp=h({type:o,selectors:[["app-root"]],decls:3,vars:0,template:function(i,a){i&1&&(s(0,"ion-app"),u(1,"ion-router-outlet")(2,"app-notification-toast"),r())},dependencies:[q,V,ot],encapsulation:2});let n=o;return n})();z(et,{providers:[{provide:j,useClass:L},Y(),U(tt,B(R))]});
